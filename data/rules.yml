version: "3.1"

rules:
- rule: Respond to email after asking
  steps:
  - action: utter_ask_email
  - intent: provide_email
  - action: utter_contract_sent
  - action: utter_additional_request

- rule: Show plans immediately after service request
  steps:
  - intent: request_internet_service
  - action: utter_show_plans

- rule: Final action - say goodbye after acknowledgement
  steps:
  - intent: provide_rating
  - action: utter_acknowledge_rating
  - action: utter_goodbye
  - action: action_session_start

- rule: Activate user verification form on billing request
  steps:
  - intent: request_billing
  - action: user_verification_form
  - active_loop: user_verification_form

- rule: Submit user verification form
  condition:
  - active_loop: user_verification_form
  steps:
  - action: user_verification_form
  - active_loop: null
  - action: action_check_billing_status
  - action: utter_additional_request
  - intent: deny
  - action: utter_ask_rating

- rule: Activate RAG for technical questions
  steps:
  - intent: request_support             
  - action: action_technical_support_rag

# Para manejar preguntas técnicas adicionales dentro del mismo turno, si el usuario hace otra pregunta
- rule: RAG for follow-up technical questions
  steps:
  # El bot ya respondió algo técnico
  - action: action_technical_support_rag 
  # O cualquier intent que captures como "pregunta"
  - intent: out_of_scope 
  - action: action_technical_support_rag